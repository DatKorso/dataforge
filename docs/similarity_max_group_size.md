# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: max_group_size –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ wb_similarity

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ –ø–æ—Ö–æ–∂–∏–º WB —Ç–æ–≤–∞—Ä–∞–º" —Å `max_candidates_per_seed=10`:
- –ü–µ—Ä–µ–¥–∞–Ω–æ: 50 wb_sku
- –û–∂–∏–¥–∞–ª–æ—Å—å: ~10-20 —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø–µ
- –ü–æ–ª—É—á–µ–Ω–æ: 1 –≥—Ä—É–ø–ø–∞ –∏–∑ 129 wb_sku

**–ü—Ä–∏—á–∏–Ω–∞**: –ø–∞—Ä–∞–º–µ—Ç—Ä `max_candidates_per_seed` –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ **–¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—Ö–æ–¥–Ω–æ–≥–æ wb_sku**, –Ω–æ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –∏—Ç–æ–≥–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–≤—è–∑–Ω–æ—Å—Ç–∏.

–ò–∑-–∑–∞ —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω—ã—Ö —Å–≤—è–∑–µ–π (seed1‚Üícand1, seed2‚Üícand1, seed3‚Üícand2, cand1‚Üícand2...) –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –ø–æ–ø–∞–¥–∞–ª–∏ –≤ –æ–¥–Ω—É –æ–≥—Ä–æ–º–Ω—É—é –≥—Ä—É–ø–ø—É.

## –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `max_group_size` –≤ `SimilarityScoringConfig`:

```python
max_group_size: int | None = 10  # –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –≥—Ä—É–ø–ø—ã (None = –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)
```

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–∑–±–∏–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –≥—Ä—É–ø–ø

–ö–æ–≥–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç `max_group_size`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∂–∞–¥–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å —É—á–µ—Ç–æ–º similarity scores**:

1. **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∞**: –¥–ª—è –∫–∞–∂–¥–æ–π –ø–∞—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏—Ö `final_score`
2. **–ü–æ–¥—Å—á–µ—Ç –≤–∞–∂–Ω–æ—Å—Ç–∏**: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å—É–º–º–∞—Ä–Ω—ã–π score –≤—Å–µ—Ö –µ–≥–æ —Å–≤—è–∑–µ–π
3. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–≥—Ä—É–ø–ø**:
   - –í—ã–±–∏—Ä–∞–µ—Ç—Å—è seed = —Ç–æ–≤–∞—Ä —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —Å—É–º–º–∞—Ä–Ω—ã–º score (—Å–∞–º—ã–π "—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π")
   - –î–æ–±–∞–≤–ª—è—é—Ç—Å—è –Ω–∞–∏–±–æ–ª–µ–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (–ø–æ —É–±—ã–≤–∞–Ω–∏—é score) –¥–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è `max_group_size`
   - –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–ª—è –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —Ç–æ–≤–∞—Ä–æ–≤

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –õ–æ–≥–∏—á–Ω–æ—Å—Ç—å: —Ç–æ–≤–∞—Ä—ã –≤ –ø–æ–¥–≥—Ä—É–ø–ø–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Ö–æ–∂–∏ (–≤—ã—Å–æ–∫–∏–µ scores)
- ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ: –Ω–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç —Å–∏–ª—å–Ω–æ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø–∞—Ä—ã
- ‚úÖ –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å: —Ä–∞–∑–º–µ—Ä –≥—Ä—É–ø–ø—ã —Å—Ç—Ä–æ–≥–æ ‚â§ max_group_size

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ max_candidates_per_seed=10)
- 50 –≤—Ö–æ–¥–Ω—ã—Ö wb_sku ‚Üí 135 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö wb_sku
- 1 –≥—Ä—É–ø–ø–∞ –∏–∑ 129 wb_sku
- 1 –≥—Ä—É–ø–ø–∞ –∏–∑ 4 wb_sku
- 1 –≥—Ä—É–ø–ø–∞ –∏–∑ 2 wb_sku

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (max_candidates_per_seed=30, max_group_size=10, min_score_threshold=300)
- 50 –≤—Ö–æ–¥–Ω—ã—Ö wb_sku ‚Üí 79 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö wb_sku (–±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–π –ø–æ—Ä–æ–≥ –æ—Ç—Å–µ—á–µ–Ω–∏—è)
- 19 –≥—Ä—É–ø–ø
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∞: 8 wb_sku
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: 8, 7, 6, 6, 6, 6, 6, 4, 4, 3...

## –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

```python
SimilarityScoringConfig(
    min_score_threshold=300.0,      # —Å—Ç—Ä–æ–≥–∏–π –ø–æ—Ä–æ–≥ –¥–ª—è –æ—Ç—Å–µ—á–µ–Ω–∏—è —Å–ª–∞–±—ã—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
    max_candidates_per_seed=30,      # –¥–æ 30 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞ –≤—Ö–æ–¥–Ω–æ–π wb_sku
    max_group_size=10,               # –≥—Ä—É–ø–ø—ã –Ω–µ –±–æ–ª–µ–µ 10 —Ç–æ–≤–∞—Ä–æ–≤
)
```

## Fallback –¥–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

–î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –Ω–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã (–Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ wb_products):

1. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–∞–∫–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ –æ–±—â–µ–º—É WB –∞—Ä—Ç–∏–∫—É–ª—É"
3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –Ω—É–º–µ—Ä–∞—Ü–∏–µ–π –≥—Ä—É–ø–ø)
4. –¢–æ–≤–∞—Ä—ã –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –≥—Ä—É–ø–ø—ã –∏–∑ 1 wb_sku

–ï—Å–ª–∏ —Ç–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–∞–∂–µ –ø–æ—Å–ª–µ fallback, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ.

## API Changes

### SimilarityScoringConfig
- ‚úÖ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω: `max_recommendations` ‚Üí `max_candidates_per_seed` (–±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω: `max_group_size: int | None = 10`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–µ—Ñ–æ–ª—Ç—ã: `min_score_threshold=300.0`, `max_candidates_per_seed=30`

### UI (08_üß©_–°–∫–ª–µ–π–∫–∞_OZ.py)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω input –¥–ª—è `max_group_size`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ –±–∞–∑–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è missing —Ç–æ–≤–∞—Ä–æ–≤

### –¢–µ—Å—Ç—ã
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `test_similarity_max_group_size` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–±–∏–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `test_similarity_max_group_size_none` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –¥–ª—è —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è `min_score_threshold=50.0`

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
from dataforge.similarity_config import SimilarityScoringConfig
from dataforge.similarity_matching import search_similar_matches

# –°—Ç—Ä–æ–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–¥–±–æ—Ä–∞
cfg = SimilarityScoringConfig(
    min_score_threshold=300.0,
    max_candidates_per_seed=30,
    max_group_size=10,
)

df = search_similar_matches(
    wb_skus=['205812919', '306395217', ...],
    config=cfg,
    md_token=token,
    md_database="dataforge",
)
```

## –î–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
2 –æ–∫—Ç—è–±—Ä—è 2025 –≥.
