# ТЗ на импорт данных из файла wb_prices.xlsx

## 1. Описание источника данных

**Формат файла:** .xlsx, .xls 
**Структура листов:** "Отчет - цены и скидки на товары" (целевой лист для обработки)  
**Расположение данных:** Данные начинаются со строки 2
**Наличие заголовков:** Да, строка 1 содержит названия колонок
**Название таблицы в БД** wb_prices

## 2. Маппинг данных

| Заголовок Excel | Название в БД | Тип данных | Обязательность |
|-----------------|---------------|------------|----------------|
| Бренд | brand | VARCHAR(100) | Необязательно |
| Категория | category | VARCHAR(150) | Необязательно |
| Артикул WB | wb_sku | VARCHAR(50) | Обязательно |
| Артикул продавца | wb_vendor_code | VARCHAR(100) | Необязательно |
| Последний баркод | barcode_primary | VARCHAR(50) | Необязательно |
| Остатки WB | wb_stock | INTEGER | Необязательно |
| Текущая цена | current_price | DECIMAL(10,2) | Необязательно |
| Текущая скидка | current_discount | DECIMAL(5,2) | Необязательно |

## 3. Правила валидации

**Форматы данных:**
- Баркод должен содержать только цифры (если заполнен)

**Уникальность:**
- Артикул WB должен быть уникальным в рамках одной загрузки

**Обязательные поля:**
- Артикул WB не может быть пустым

## 4. Обработка ошибок

**Дублирующиеся записи:**
- Каждая загрузка нового отчета будет вести к дублированию записей, поэтому нужно перед новой записью очищать таблицу.

**Некорректные данные:**
- Пропустить строку с ошибкой и продолжить обработку
- Записать детальную информацию об ошибке в лог
- В конце импорта показать сводку: обработано/пропущено/ошибок

**Логирование ошибок:**
- Обязательно логировать все ошибки валидации
- Указывать номер строки и тип ошибки
- Сохранять лог в файл с timestamp

**Стратегия:**
- Пропустить строку при ошибке и продолжить обработку
- Не останавливать весь процесс из-за одной некорректной записи

## 5. Дополнительные требования

**Преобразования данных:**
- Привести названия брендов и категорий к единому регистру (title case), если поля заполнены
- Преобразовать пустые строки в NULL для числовых полей
- Округлить цены до целочисленных

**Производительность:**
- Использовать транзакции для обеспечения целостности данных
- Создать индексы по полям: wb_sku, barcode-primary
- Показывать прогресс обработки пользователю