# Техническое задание: Импорт данных заказов Ozon

## 1. Описание источника данных

**Формат файла:** .csv  
**Структура файлов:** oz_orders.csv - единый файл с данными заказов  
**Расположение данных:** Начиная с строки 1 (заголовки), данные со строки 2  
**Наличие заголовков:** Да, строка 1 содержит названия колонок  
**Разделитель:** ; (точка с запятой)  
**Кодировка:** UTF-8  
**Название таблицы в БД** oz_orders

## 2. Маппинг данных

| Колонка CSV | Название в БД | Тип данных | Обязательность |
|-------------|---------------|------------|----------------|
| Номер заказа | order_number | VARCHAR(50) | Обязательно |
| Номер отправления | shipment_number | VARCHAR(50) | Обязательно |
| Принят в обработку | processing_date | TIMESTAMP | Необязательно |
| Дата отгрузки | shipment_date | TIMESTAMP | Необязательно |
| Статус | status | VARCHAR(100) | Необязательно |
| Дата доставки | delivery_date | TIMESTAMP | Необязательно |
| Фактическая дата передачи в доставку | actual_delivery_transfer_date | TIMESTAMP | Необязательно |
| Сумма отправления | shipment_amount | DECIMAL(10,2) | Необязательно |
| Код валюты отправления | shipment_currency_code | VARCHAR(3) | Необязательно |
| Наименование товара | product_name | TEXT | Необязательно |
| OZON id | oz_product_id | BIGINT | Обязательно |
| Артикул | oz_vendor_code | VARCHAR(100) | Обязательно |
| Ваша цена | your_product_cost | DECIMAL(10,2) | Необязательно |
| Код валюты товара | product_currency_code | VARCHAR(3) | Необязательно |
| Стоимость товара для покупателя | customer_product_cost | DECIMAL(10,2) | Необязательно |
| Код валюты покупателя | customer_currency_code | VARCHAR(3) | Необязательно |
| Количество | quantity | INTEGER | Необязательно |
| Стоимость доставки | delivery_cost | DECIMAL(10,2) | Необязательно |
| Связанные отправления | related_shipments | TEXT | Необязательно |
| Выкуп товара | product_buyout | VARCHAR(50) | Необязательно |
| Цена товара до скидок | price_before_discount | DECIMAL(10,2) | Необязательно |
| Скидка % | discount_percent | VARCHAR(10) | Необязательно |
| Скидка руб | discount_amount | DECIMAL(10,2) | Необязательно |
| Акции | promotions | TEXT | Необязательно |

## 3. Правила валидации

### Уникальность:
- **Номер отправления** должен быть уникальным в рамках одной загрузки

### Обязательные поля:
- Номер заказа
- OZON id

## 4. Обработка ошибок

### Дублирующиеся записи:
- Каждая загрузка нового отчета будет вести к дублированию записей, поэтому нужно перед новой записью очищать таблицу.

### Некорректные данные:
- Пропустить строку с ошибкой валидации
- Записать детали ошибки в лог с указанием номера строки и типа ошибки
- Продолжить обработку следующих строк

### Стратегия:
- **Продолжить обработку** при ошибках в отдельных строках
- **Остановить импорт** только при критических ошибках (недоступность БД, неверная структура файла)
- Создать отчет с количеством обработанных/пропущенных записей

## 5. Дополнительные требования

### Производительность:
- **Индексы:** Создать индексы по oz_product_id, oz_vendor_code
- **Транзакции:** Использовать транзакции для каждого пакета

### Безопасность:
- Валидировать размер файла (максимум 200MB)